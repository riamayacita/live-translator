<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Live Voice Translator</title>
</head>
<body>
  <h1>Live Voice Translator</h1>

  <p><strong>Speak:</strong></p>
  <select id="sourceLang">
    <option value="en">English</option>
    <option value="it">Italian</option>
    <option value="es">Spanish</option>
    <option value="id">Indonesian</option>
  </select>

  <p><strong>Translate to:</strong></p>
  <select id="targetLang">
    <option value="it">Italian</option>
    <option value="en">English</option>
    <option value="es">Spanish</option>
    <option value="id">Indonesian</option>
  </select>

  <br><br>
  <button id="startBtn">Start Listening</button>
  <p id="transcript">Transcript: </p>
  <p id="translation">Translation: </p>

  <script>
    const startBtn = document.getElementById('startBtn');
    const transcriptEl = document.getElementById('transcript');
    const translationEl = document.getElementById('translation');

    let recognition;
    if ('webkitSpeechRecognition' in window) {
      recognition = new webkitSpeechRecognition();
    } else if ('SpeechRecognition' in window) {
      recognition = new SpeechRecognition();
    } else {
      alert('Speech Recognition not supported');
    }

    if (recognition) {
      recognition.continuous = false;
      recognition.interimResults = false;

      startBtn.onclick = () => {
        const sourceLang = document.getElementById("sourceLang").value;
        recognition.lang = sourceLang;
        recognition.start();
      };

      recognition.onresult = async (event) => {
        const sourceLang = document.getElementById("sourceLang").value;
        const targetLang = document.getElementById("targetLang").value;
        const transcript = event.results[0][0].transcript;
        transcriptEl.innerText = "Transcript: " + transcript;
        translationEl.innerText = "Translation: Translating...";

        try {
          const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent("https://api.mymemory.translated.net/get?q=" + encodeURIComponent(transcript) + "&langpair=" + sourceLang + "|" + targetLang)}`);
          const data = await response.json();
          const contents = JSON.parse(data.contents);
          const translatedText = contents.responseData.translatedText;
          translationEl.innerText = "Translation: " + translatedText;
        } catch (error) {
          translationEl.innerText = "Translation error: " + error;
        }
      };

      recognition.onerror = (e) => {
        console.error("Recognition error:", e.error);
      };
    }
  </script>
</body>
</html>
