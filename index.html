<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Live Translator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    button {
      margin: 10px 5px;
      padding: 10px;
    }
    .output {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Live Translator</h1>

  <label for="sourceLang">From:</label>
  <select id="sourceLang">
    <option value="en">English</option>
    <option value="it">Italian</option>
    <option value="es">Spanish</option>
    <option value="id">Indonesian</option>
  </select>

  <label for="targetLang">To:</label>
  <select id="targetLang">
    <option value="en">English</option>
    <option value="it">Italian</option>
    <option value="es">Spanish</option>
    <option value="id">Indonesian</option>
  </select>

  <div>
    <button onclick="startListening()">Start Listening</button>
    <button onclick="stopListening()">Stop Listening</button>
  </div>

  <div class="output">
    <p><strong>Original:</strong> <span id="originalText">...</span></p>
    <p><strong>Translation:</strong> <span id="translatedText">...</span></p>
  </div>

  <script>
    let recognition;
    let isListening = false;

    function startListening() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        alert("Your browser does not support Speech Recognition.");
        return;
      }

      recognition = new SpeechRecognition();
      recognition.continuous = true;
      recognition.interimResults = true;
      recognition.lang = document.getElementById("sourceLang").value;

      recognition.onresult = async (event) => {
        let interimTranscript = '';
        for (let i = event.resultIndex; i < event.results.length; ++i) {
          if (event.results[i].isFinal) {
            const finalTranscript = event.results[i][0].transcript.trim();
            document.getElementById("originalText").textContent = finalTranscript;
            translateText(finalTranscript);
          } else {
            interimTranscript += event.results[i][0].transcript;
            document.getElementById("originalText").textContent = interimTranscript;
          }
        }
      };

      recognition.onerror = (event) => {
        console.error("Speech Recognition error:", event.error);
      };

      recognition.start();
      isListening = true;
    }

    function stopListening() {
      if (recognition && isListening) {
        recognition.stop();
        isListening = false;
      }
    }

    async function translateText(text) {
      const from = document.getElementById("sourceLang").value;
      const to = document.getElementById("targetLang").value;
      const encodedText = encodeURIComponent(text);
      const url = `https://api.mymemory.translated.net/get?q=${encodedText}&langpair=${from}|${to}`;

      try {
        const res = await fetch(url);
        const data = await res.json();
        const translated = data.responseData.translatedText;
        document.getElementById("translatedText").textContent = translated;
      } catch (error) {
        console.error("Translation error:", error);
        document.getElementById("translatedText").textContent = "Error translating.";
      }
    }
  </script>
</body>
</html>
